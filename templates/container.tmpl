{{- /*gotype: necron.dev/pkg/bubble.tmplData*/ -}}
// Code generated by bubble, DO NOT EDIT.
package {{ .PkgName }}

import (
    {{- range $path, $alias := .Imports }}
    {{ $alias }} "{{ $path }}"
    {{- end }}
)

type (
    ContainerKey string

    Container struct {
        {{- range .Services }}
        _{{ .Name }} {{ .Type.String }}
        {{- end }}
    }

    ContainerConstructor struct {
{{- range .Services }}
        Provide{{ .Name }} func({{ join .ProvFn.Params ", " }}) ({{ join .ProvFn.Returns ", " }})
{{- end }}
    }
)

var DefaultContainerKey = ContainerKey("bubble")

func NewContainer(c ContainerConstructor) (*Container, error) {
    var e error
    ctn := new(Container)
    {{ range .Services }}
    ctn._{{ .Name }} {{- if .ProvFn.ShouldReturnError -}}, e {{- end }} = c.Provide{{ .Name }}({{ join (prefix "ctn._" .ProvFn.Args) ", " }})
        {{- if .ProvFn.ShouldReturnError }}
    if e != nil {
        return nil, fmt.Errorf("failed to provide '{{ .Name }}': %w", e)
    }
        {{ end }}
    {{ end }}

    return ctn, nil
}
{{ range .Services }}
func (c *Container) {{ .Name }}() {{ .Type.String }} {
    return c._{{ .Name }}
}
{{ end }}

var C = func(i any) *Container {
    switch v := i.(type) {
    case *Container:
        return v
    case context.Context:
        return v.Value(DefaultContainerKey).(*Container)
    default:
        return nil
    }
}